% 收到相位信息计算V和Q

% SU CB=1, bphi=6, bpsi=4
% kphi = 0, 1, ..., 2^6-1  kpsi=0, 1, ..., 2^4-1
% phi=(k*pi)/(2^(6-1)) + pi/2^6
% psi=(k*pi)/(2^(4+1)) + pi/2^(4+2)

bphi = 9;
bpsi = 7;

%
kphi_u0 = [282 305 326 349 365 391 410 456 479 495 7 24 41 56 71 88 106 123 138 153 194 215 235 254 272 296 329 344 362 378 391 405 446 466 483 508 12 34 55 77 98 121 134 160 179 220 241 254 279 295 315 339 ];
kpsi_u0 = [80 81 81 81 85 82 81 91 87 87 88 91 92 92 94 96 97 97 97 96 102 99 101 103 105 106 108 108 108 105 107 107 108 105 105 103 102 102 103 101 101 101 103 103 101 106 104 103 105 106 106 106 ];

kphi_u1 = [150 168 193 211 233 257 272 322 344 359 386 405 428 447 466 486 506 9 32 47 92 116 137 162 184 205 250 262 286 299 318 337 379 402 419 447 465 486 504 11 31 52 71 87 102 136 188 303 445 466 484 507 ];
kpsi_u1 = [83 83 83 82 86 82 78 87 82 82 82 84 83 84 83 84 82 84 82 78 84 80 80 80 77 73 81 80 81 78 78 76 82 76 75 75 76 76 76 76 77 77 79 80 77 105 111 122 111 105 99 98 ];

phi_u0 = (kphi_u0*pi)/(2^(bphi-1)) + pi/(2^bphi);
psi_u0 = (kpsi_u0*pi)/(2^(bpsi+1)) + pi/(2^(bpsi+2));
phi_u1 = (kphi_u1*pi)/(2^(bphi-1)) + pi/(2^bphi);
psi_u1 = (kpsi_u1*pi)/(2^(bpsi+1)) + pi/(2^(bpsi+2));

% Nc=Nr=2, V = D G^T
v11_u0 = exp(1j*phi_u0).*cos(psi_u0);
v12_u0 = -exp(1j*phi_u0).*sin(psi_u0);
v21_u0 = sin(psi_u0);
v22_u0 = cos(psi_u0);
v11_u1 = exp(1j*phi_u1).*cos(psi_u1);
v12_u1 = -exp(1j*phi_u1).*sin(psi_u1);
v21_u1 = sin(psi_u1);
v22_u1 = cos(psi_u1);

% -28 -21 -7  0  +7  +21  +28
%   7   13   6   6  13  7
%  1  8   22  29  36  50  57
V11_u0 = [1 1 1 1 v11_u0(1:7) 1 v11_u0(8:20) 1 v11_u0(21:26) 1 v11_u0(27:32) 1 v11_u0(33:45) 1 v11_u0(46:52) 1 1 1];
V12_u0 = [1 1 1 1 v12_u0(1:7) 1 v12_u0(8:20) 1 v12_u0(21:26) 1 v12_u0(27:32) 1 v12_u0(33:45) 1 v12_u0(46:52) 1 1 1];
V21_u0 = [1 1 1 1 v21_u0(1:7) 1 v21_u0(8:20) 1 v21_u0(21:26) 1 v21_u0(27:32) 1 v21_u0(33:45) 1 v21_u0(46:52) 1 1 1];
V22_u0 = [1 1 1 1 v22_u0(1:7) 1 v22_u0(8:20) 1 v22_u0(21:26) 1 v22_u0(27:32) 1 v22_u0(33:45) 1 v22_u0(46:52) 1 1 1];
V11_u1 = [1 1 1 1 v11_u1(1:7) 1 v11_u1(8:20) 1 v11_u1(21:26) 1 v11_u1(27:32) 1 v11_u1(33:45) 1 v11_u1(46:52) 1 1 1];
V12_u1 = [1 1 1 1 v12_u1(1:7) 1 v12_u1(8:20) 1 v12_u1(21:26) 1 v12_u1(27:32) 1 v12_u1(33:45) 1 v12_u1(46:52) 1 1 1];
V21_u1 = [1 1 1 1 v21_u1(1:7) 1 v21_u1(8:20) 1 v21_u1(21:26) 1 v21_u1(27:32) 1 v21_u1(33:45) 1 v21_u1(46:52) 1 1 1];
V22_u1 = [1 1 1 1 v22_u1(1:7) 1 v22_u1(8:20) 1 v22_u1(21:26) 1 v22_u1(27:32) 1 v22_u1(33:45) 1 v22_u1(46:52) 1 1 1];

% Q = V/V^HV
V = zeros(64,2,2);
V(:,1,1) =V11_u0;
V(:,2,1) =V21_u0;
V(:,1,2) =V11_u1;
V(:,2,2) =V21_u1;

for ii = 1:64
    h = squeeze(V(ii,:,:));
    Q(ii,:,:) = h/(h'*h); 
end